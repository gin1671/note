<!doctype html> <html> <head> <meta charset=utf-8 /> <meta http-equiv=X-UA-Compatible content='ie=edge'/> <meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no"/> <title>Blog Title - 環境構築3</title> <link rel=alternate type="application/atom+xml" title="Atom Feed" href="/feed.xml"/> <link href="/note/assets/stylesheets/app-524c795c.css" rel=stylesheet /> <script src="/note/assets/javascripts/app-eaf002be.js"></script> </head> <body> <div id=main role=main> <nav class="navbar navbar-expand-lg navbar-light bg-light"> <a class=navbar-brand href="https://github.com/nyantech14">ねこの手システム</a> <button class=navbar-toggler type=button data-toggle=collapse data-target="#navbarNav" aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> <div class="collapse navbar-collapse" id=navbarNav> <ul class=navbar-nav> <li class=nav-item> <a class="nav-link active" href="/note/">トップページ</a> </li> <li class=nav-item> <a class=nav-link href="/note/note.html">開発ノート</a> </li> </ul> </div> </nav> <div class="container article-outside-container"> <div class=row> <div class="col-md-8 blog-main"> <h3> 環境構築3 </h3> <hr> <h2>主な作業内容</h2> <ul> <li>MySQLエラー再発の解決</li> <li>メモ方法、整理、情報集約のやり方を見直し</li> <li>ターミナルのログ自動出力設定</li> </ul> <h2>困ったところ</h2> <p>Mysqlでまた躓く… 立ち上がっていないからリスタートしたらまた昨日と同じ状態に。 <code> % mysql.server restart Shutting down MySQL .. SUCCESS! Starting MySQL .. ERROR! The server quit without updating PID file (/usr/local/var/mysql/pc.local.pid). </code></p> <p>昨日はsockの問題だったので、削除しにいく…がない。 <code> % ls /tmp/ 59e50304-66b4-4b55-4172-2cd7a5193156_autoUpdaterStart_rca_response.txt fs-capricorniUjSMy AlTest1.err fsavd-tmp-125-000113 AlTest1.out fsavd-tmp-125-000114 adobegc.log fsavd-tmp-125-000115 bitrock_installer.log fsavd-tmp-125-000116 bitrock_installer_31956.log fsdbupdate_guts2_redirect_stderr_pipe.31846 c860f0e2-6785-454a-51fa-838e53610f14_autoUpdaterStart_rca_response.txt fsdbupdate_guts2_redirect_stdout_pipe.31846 com.apple.launchd.KNxaMcM3Ag powerlog com.google.Keystone </code></p> <p>とりあえずエラーログを見に行く。</p> <p>逆にsockがないと怒られる。 <code> % mysql -u root ERROR 2002 (HY000): Can&#39;t connect to local MySQL server through socket &#39;/tmp/mysql.sock&#39; (2) </code></p> <p>logがない…？ <code> % tail -f /var/log/mysqld.log tail: /var/log/mysqld.log: No such file or directory </code></p> <p>sockを作ってみる。次は権限がない、と。 <code> % sudo touch /tmp/mysql.sock % mysql -u root ERROR 2002 (HY000): Can&#39;t connect to local MySQL server through socket &#39;/tmp/mysql.sock&#39; (38) </code></p> <p>エラーログはこっちだった。/usr/local/var/mysql/pc.local.err <code> % mysql.server start Starting MySQL ./usr/local/Cellar/mysql@5.7/5.7.29/bin/mysqld_safe: line 144: /usr/local/var/mysql/pc.local.err: Permission denied /usr/local/Cellar/mysql@5.7/5.7.29/bin/mysqld_safe: line 144: /usr/local/var/mysql/pc.local.err: Permission denied /usr/local/Cellar/mysql@5.7/5.7.29/bin/mysqld_safe: line 198: /usr/local/var/mysql/pc.local.err: Permission denied /usr/local/Cellar/mysql@5.7/5.7.29/bin/mysqld_safe: line 144: /usr/local/var/mysql/pc.local.err: Permission denied ERROR! The server quit without updating PID file (/usr/local/var/mysql/pc.local.pid). </code></p> <p>mysql 5.7になっている？ <code> $ which mysql.server /usr/local/bin/mysql.server $ ll /usr/local/bin/mysql.server lrwxr-xr-x 1 nobyuki admin 41 7 6 11:10 /usr/local/bin/mysql.server -&gt; ../Cellar/mysql/8.0.19_1/bin/mysql.server </code></p> <pre><code>% mysql.server start
Starting MySQL
./usr/local/Cellar/mysql/8.0.19_1/bin/mysqld_safe: line 144: /usr/local/var/mysql/pc.local.err: Permission denied
/usr/local/Cellar/mysql/8.0.19_1/bin/mysqld_safe: line 144: /usr/local/var/mysql/pc.local.err: Permission denied
/usr/local/Cellar/mysql/8.0.19_1/bin/mysqld_safe: line 199: /usr/local/var/mysql/pc.local.err: Permission denied
/usr/local/Cellar/mysql/8.0.19_1/bin/mysqld_safe: line 144: /usr/local/var/mysql/pc.local.err: Permission denied
ERROR! The server quit without updating PID file (/usr/local/var/mysql/pc.local.pid).
</code></pre> <pre><code>% ls -l /usr/local/var/mysql/
total 311488
drwxr-x---    2 _mysql  _mysql        64  7  7 10:48 #innodb_temp
-rw-r-----    1 _mysql  _mysql     52401  7  7 11:57 pc.local.err
-rw-r-----    1 _mysql  _mysql        56  7  7 10:48 auto.cnf
-rw-------    1 _mysql  _mysql      1676  7  7 10:48 ca-key.pem
-rw-r--r--    1 _mysql  _mysql      1112  7  7 10:48 ca.pem
-rw-r--r--    1 _mysql  _mysql      1112  7  7 10:48 client-cert.pem
-rw-------    1 _mysql  _mysql      1676  7  7 10:48 client-key.pem
-rw-r-----    1 _mysql  _mysql      5894  7  7 10:48 ib_buffer_pool
-rw-r-----    1 _mysql  _mysql  50331648  7  7 10:48 ib_logfile0
-rw-r-----    1 _mysql  _mysql  50331648  7  7 10:48 ib_logfile1
-rw-r-----    1 _mysql  _mysql  12582912  7  7 10:48 ibdata1
drwxr-x---    8 _mysql  _mysql       256  7  7 10:48 mysql
-rw-r-----    1 _mysql  _mysql  25165824  7  7 10:48 mysql.ibd
drwxr-x---  105 _mysql  _mysql      3360  7  7 10:48 performance_schema
-rw-------    1 _mysql  _mysql      1676  7  7 10:48 private_key.pem
-rw-r--r--    1 _mysql  _mysql       452  7  7 10:48 public_key.pem
-rw-r--r--    1 _mysql  _mysql      1112  7  7 10:48 server-cert.pem
-rw-------    1 _mysql  _mysql      1676  7  7 10:48 server-key.pem
drwxr-x---    3 _mysql  _mysql        96  7  7 10:48 sys
-rw-r-----    1 _mysql  _mysql  10485760  7  7 10:48 undo_001
-rw-r-----    1 _mysql  _mysql  10485760  7  7 10:48 undo_002
</code></pre> <pre><code>% sudo chown -R user:admin /usr/local/var/mysql/
Password:
% ls -l /usr/local/var/mysql/
total 311488
drwxr-x---    2 user  admin        64  7  7 10:48 #innodb_temp
-rw-r-----    1 user  admin     52401  7  7 11:57 pc.local.err
-rw-r-----    1 user  admin        56  7  7 10:48 auto.cnf
-rw-------    1 user  admin      1676  7  7 10:48 ca-key.pem
-rw-r--r--    1 user  admin      1112  7  7 10:48 ca.pem
-rw-r--r--    1 user  admin      1112  7  7 10:48 client-cert.pem
-rw-------    1 user  admin      1676  7  7 10:48 client-key.pem
-rw-r-----    1 user  admin      5894  7  7 10:48 ib_buffer_pool
-rw-r-----    1 user  admin  50331648  7  7 10:48 ib_logfile0
-rw-r-----    1 user  admin  50331648  7  7 10:48 ib_logfile1
-rw-r-----    1 user  admin  12582912  7  7 10:48 ibdata1
drwxr-x---    8 user  admin       256  7  7 10:48 mysql
-rw-r-----    1 user  admin  25165824  7  7 10:48 mysql.ibd
drwxr-x---  105 user  admin      3360  7  7 10:48 performance_schema
-rw-------    1 user  admin      1676  7  7 10:48 private_key.pem
-rw-r--r--    1 user  admin       452  7  7 10:48 public_key.pem
-rw-r--r--    1 user  admin      1112  7  7 10:48 server-cert.pem
-rw-------    1 user  admin      1676  7  7 10:48 server-key.pem
drwxr-x---    3 user  admin        96  7  7 10:48 sys
-rw-r-----    1 user  admin  10485760  7  7 10:48 undo_001
-rw-r-----    1 user  admin  10485760  7  7 10:48 undo_002
</code></pre> <pre><code>% less /usr/local/var/mysql/pc.local.err
2020-07-07T03:43:44.6NZ mysqld_safe Logging to &#39;/usr/local/var/mysql/pc.local.err&#39;.
2020-07-07T03:43:44.6NZ mysqld_safe Starting mysqld daemon with databases from /usr/local/var/mysql
2020-07-07T03:43:47.009393Z 0 [System] [MY-010116] [Server] /usr/local/Cellar/mysql/8.0.19_1/bin/mysqld (mysqld 8.0.19) starting as process 10250
2020-07-07T03:43:47.024489Z 0 [Warning] [MY-010159] [Server] Setting lower_case_table_names=2 because file system for /usr/local/var/mysql/ is case insensitive
2020-07-07T03:43:47.752802Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.
2020-07-07T03:43:47.758227Z 0 [ERROR] [MY-010270] [Server] Can&#39;t start server : Bind on unix socket: Address already in use
2020-07-07T03:43:47.758438Z 0 [ERROR] [MY-010258] [Server] Do you already have another mysqld server running on socket: /tmp/mysql.sock ?
2020-07-07T03:43:47.759064Z 0 [ERROR] [MY-010119] [Server] Aborting
2020-07-07T03:43:48.847136Z 0 [System] [MY-010910] [Server] /usr/local/Cellar/mysql/8.0.19_1/bin/mysqld: Shutdown complete (mysqld 8.0.19)  Homebrew.
2020-07-07T03:43:48.6NZ mysqld_safe mysqld from pid file /usr/local/var/mysql/pc.local.pid ended
</code></pre> <pre><code>% ls /tmp/
59e50304-66b4-4b55-4172-2cd7a5193156_autoUpdaterStart_rca_response.txt  fs-capricorn3IcxPQ
AlTest1.err                             fsavd-tmp-125-000116
AlTest1.out                             fsavd-tmp-125-000117
adobegc.log                             fsavd-tmp-125-000118
bitrock_installer.log                           mysql.sock
bitrock_installer_31956.log                     mysql.sock.lock
c860f0e2-6785-454a-51fa-838e53610f14_autoUpdaterStart_rca_response.txt  powerlog
com.apple.launchd.KNxaMcM3Ag                        wbxtrace
com.google.Keystone
</code></pre> <pre><code>% sudo rm /tmp/mysql.sock*
% ls /tmp/
59e50304-66b4-4b55-4172-2cd7a5193156_autoUpdaterStart_rca_response.txt  com.google.Keystone
AlTest1.err                             fs-capricorn3IcxPQ
AlTest1.out                             fsavd-tmp-125-000116
adobegc.log                             fsavd-tmp-125-000117
bitrock_installer.log                           fsavd-tmp-125-000118
bitrock_installer_31956.log                     powerlog
c860f0e2-6785-454a-51fa-838e53610f14_autoUpdaterStart_rca_response.txt  wbxtrace
com.apple.launchd.KNxaMcM3Ag
</code></pre> <h3>学び</h3> <ul> <li>なにか問題が起きたら、まずエラーログを見る癖をつける。</li> <li>問題は切り分けていく。現在出ているエラーメッセージに注視する。</li> <li><p>その場のメモは、ターミナルのlogを全部取得して保存しておく。後でキーワード検索すると同じ事例が出てきて便利。</p></li> <li><p>ターミナルのログを自動取得</p> <ul> <li>ログ出力用のディレクトリを作成する（scriptlogs）</li> <li>ターミナルの環境設定を開く。</li> </ul></li> </ul> <pre><code>directory=~/scriptlogs/$(date +%Y)/$(date +%m)/$(date +%d);filename=script_$(date +%H%M%S).txt;mkdir -p ${directory}; script ${directory}/${filename}
</code></pre> <p>~/scriptlogs/yyyy/mm/dd/script_hhmmss.txt</p> </div> <aside class="col-md-4 blog-sidebar"> <div class="p-3 mb-3 bg-light rounded"> <h4 class=font-italic>Rails開発ノート</h4> <p class=mb-0> 日々学んだことや開発過程の記録場所。 </p> </div> <div class=p-3> <h4 class=font-italic>最新投稿</h4> <ol class=list-unstyled> <li> <span>2020/08/03</span> <a href="/note/2020/08/03/post.html">gitのfetchについて</a> </li> <li> <span>2020/07/31</span> <a href="/note/2020/07/31/post.html">ツイートデータの取得を試す</a> </li> <li> <span>2020/07/13</span> <a href="/note/2020/07/13/post.html">gem導入や初期設定など</a> </li> <li> <span>2020/07/10</span> <a href="/note/2020/07/10/post.html">gem導入や初期設定など2</a> </li> <li> <span>2020/07/09</span> <a href="/note/2020/07/09/post.html">gem導入や初期設定など</a> </li> <li> <span>2020/07/07</span> <a href="/note/2020/07/07/post.html">環境構築3</a> </li> <li> <span>2020/07/06</span> <a href="/note/2020/07/06/post.html">環境構築2</a> </li> <li> <span>2020/07/03</span> <a href="/note/2020/07/03/post.html">環境構築</a> </li> <li> <span>2020/07/02</span> <a href="/note/2020/07/02/post.html">ミニマムリリースを目指す</a> </li> <li> <span>2020/07/01</span> <a href="/note/2020/07/01/post.html">TweetReaderサービス構想</a> </li> </ol> </div> <div class=p-3> <h4 class=font-italic>タグ</h4> <ol class=list-unstyled> <li> <a href="/note/tags/tr-v0-0-2.html">TR_v0.0.2 (2)</a> </li> <li> <a href="/note/tags/tr-v0-0-1.html">TR_v0.0.1 (8)</a> </li> </ol> </div> <div class=p-3> <h4 class=font-italic>年別</h4> <ol class=list-unstyled> <li> <a href="/note/2020.html">2020 (10)</a> </li> </ol> </div> </aside> </div> </div> <footer class=my-footer> <p></p> </footer> </div> </body> </html>